#include "font.h"

// Русский шрифт 5x8 (А-Я, без ЁЙ) + пробел
const uint8_t font_5x8[][5] = {
    // Цифры 0-9 (индексы 0-9)
    {0x3E, 0x51, 0x49, 0x45, 0x3E}, // 0
    {0x00, 0x42, 0x7F, 0x40, 0x00}, // 1
    {0x42, 0x61, 0x51, 0x49, 0x46}, // 2
    {0x21, 0x41, 0x45, 0x4B, 0x31}, // 3
    {0x18, 0x14, 0x12, 0x7F, 0x10}, // 4
    {0x27, 0x45, 0x45, 0x45, 0x39}, // 5
    {0x3C, 0x4A, 0x49, 0x49, 0x30}, // 6
    {0x01, 0x71, 0x09, 0x05, 0x03}, // 7
    {0x36, 0x49, 0x49, 0x49, 0x36}, // 8
    {0x06, 0x49, 0x49, 0x29, 0x1E}, // 9
    // Буквы
    {0x7C, 0x12, 0x11, 0x12, 0x7C}, // А (1040)
    {0x7F, 0x49, 0x49, 0x49, 0x31}, // Б (1041)
    {0x7F, 0x49, 0x49, 0x49, 0x36}, // В (1042)
    {0x7F, 0x01, 0x01, 0x01, 0x01}, // Г (1043)
    {0x60, 0x3E, 0x21, 0x3F, 0x60}, // Д (1044)
    {0x7F, 0x49, 0x49, 0x49, 0x41}, // Е (1045)
    {0x77, 0x08, 0x7F, 0x08, 0x77}, // Ж (1046)
    {0x22, 0x41, 0x49, 0x49, 0x36}, // З (1047)
    {0x7F, 0x60, 0x18, 0x06, 0x7F}, // И (1048)
    {0x7F, 0x60, 0x18, 0x06, 0x7F}, // И (1048)
    {0x00, 0x7F, 0x18, 0x24, 0x43}, // К (1050)
    {0x00, 0x78, 0x06, 0x01, 0x7E}, // Л (1051)
    {0x7F, 0x02, 0x0C, 0x02, 0x7F}, // М (1052)
    {0x00, 0x7F, 0x18, 0x18, 0x7F}, // Н (1053)
    {0x3E, 0x41, 0x41, 0x41, 0x3E}, // О (1054)
    {0x7F, 0x01, 0x01, 0x01, 0x7F}, // П (1055)
    {0x7F, 0x09, 0x09, 0x09, 0x06}, // Р (1056)
    {0x3E, 0x41, 0x41, 0x41, 0x22}, // С (1057)
    {0x01, 0x01, 0x7F, 0x01, 0x01}, // Т (1058)
    {0x47, 0x48, 0x48, 0x48, 0x3F}, // У (1059)
    {0x1C, 0x22, 0x7F, 0x22, 0x1C}, // Ф (1060)
    {0x63, 0x14, 0x08, 0x14, 0x63}, // Х (1061)
    {0x3F, 0x20, 0x20, 0x3F, 0xC0}, // Ц (1062)
    {0x00, 0x0F, 0x08, 0x08, 0x7F}, // Ч (1063)
    {0x7F, 0x40, 0x7F, 0x40, 0x7F}, // Ш (1064)
    {0x7F, 0x40, 0x7F, 0x40, 0xFF}, // Щ (1065)
    {0x00, 0x01, 0x7F, 0x48, 0x78}, // Ъ (1066)
    {0x7F, 0x48, 0x68, 0x00, 0x7F}, // Ы (1067)
    {0x00, 0x00, 0x7F, 0x48, 0x78}, // Ь (1068)
    {0x00, 0x49, 0x49, 0x49, 0x7F}, // Э (1069)
    {0x7F, 0x18, 0x7F, 0x41, 0x7F}, // Ю (1070)
    {0x00, 0x4F, 0x29, 0x19, 0x7F}, // Я (1071)
    {0x00, 0x00, 0x00, 0x00, 0x00},  // Пробел (42)
    {0x60, 0x60, 0x00, 0x00, 0x00},  // Точка (43)
    {0x00, 0xE0, 0x60, 0x00, 0x00},  // Запятая (44)
    {0x00, 0x00, 0x00, 0x5F, 0x00},  // Восклицательный знак (45)
    {0x00, 0x03, 0x01, 0x5D, 0x03},  // Вопросительный знак (46)
};

// Вертикальный шрифт 8x5, повернутый из font_5x8
const uint8_t font_8x5[][8] = {
    { 0x00, 0x0E, 0x11, 0x13, 0x15, 0x19, 0x11, 0x0E },
    { 0x00, 0x0E, 0x04, 0x04, 0x04, 0x04, 0x06, 0x04 },
    { 0x00, 0x1F, 0x02, 0x04, 0x08, 0x10, 0x11, 0x0E },
    { 0x00, 0x0E, 0x11, 0x10, 0x08, 0x04, 0x08, 0x1F },
    { 0x00, 0x08, 0x08, 0x1F, 0x09, 0x0A, 0x0C, 0x08 },
    { 0x00, 0x0E, 0x11, 0x10, 0x10, 0x0F, 0x01, 0x1F },
    { 0x00, 0x0E, 0x11, 0x11, 0x0F, 0x01, 0x02, 0x0C },
    { 0x00, 0x02, 0x02, 0x02, 0x04, 0x08, 0x10, 0x1F },
    { 0x00, 0x0E, 0x11, 0x11, 0x0E, 0x11, 0x11, 0x0E },
    { 0x00, 0x06, 0x08, 0x10, 0x1E, 0x11, 0x11, 0x0E },
    { 0x00, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x0A, 0x04 },
    { 0x00, 0x0F, 0x11, 0x11, 0x0F, 0x01, 0x01, 0x1F },
    { 0x00, 0x0F, 0x11, 0x11, 0x0F, 0x11, 0x11, 0x0F },
    { 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x1F },
    { 0x00, 0x11, 0x1F, 0x0A, 0x0A, 0x0A, 0x0A, 0x0C },
    { 0x00, 0x1F, 0x01, 0x01, 0x0F, 0x01, 0x01, 0x1F },
    { 0x00, 0x15, 0x15, 0x15, 0x0E, 0x15, 0x15, 0x15 },
    { 0x00, 0x0E, 0x11, 0x10, 0x0C, 0x10, 0x11, 0x0E },
    { 0x00, 0x13, 0x13, 0x15, 0x15, 0x19, 0x19, 0x11 },
    { 0x00, 0x13, 0x13, 0x15, 0x15, 0x19, 0x19, 0x11 },
    { 0x00, 0x12, 0x0A, 0x06, 0x06, 0x0A, 0x12, 0x12 },
    { 0x00, 0x12, 0x12, 0x12, 0x12, 0x14, 0x14, 0x08 },
    { 0x00, 0x11, 0x11, 0x11, 0x15, 0x15, 0x1B, 0x11 },
    { 0x00, 0x12, 0x12, 0x1E, 0x1E, 0x12, 0x12, 0x12 },
    { 0x00, 0x0E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E },
    { 0x00, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x1F },
    { 0x00, 0x01, 0x01, 0x01, 0x0F, 0x11, 0x11, 0x0F },
    { 0x00, 0x0E, 0x11, 0x01, 0x01, 0x01, 0x11, 0x0E },
    { 0x00, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x1F },
    { 0x00, 0x0F, 0x10, 0x10, 0x1E, 0x11, 0x11, 0x11 },
    { 0x00, 0x04, 0x0E, 0x15, 0x15, 0x15, 0x0E, 0x04 },
    { 0x00, 0x11, 0x11, 0x0A, 0x04, 0x0A, 0x11, 0x11 },
    { 0x10, 0x10, 0x0F, 0x09, 0x09, 0x09, 0x09, 0x09 },
    { 0x00, 0x10, 0x10, 0x10, 0x1E, 0x12, 0x12, 0x12 },
    { 0x00, 0x1F, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15 },
    { 0x10, 0x1F, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15 },
    { 0x00, 0x1C, 0x14, 0x14, 0x1C, 0x04, 0x04, 0x06 },
    { 0x00, 0x17, 0x15, 0x11, 0x17, 0x11, 0x11, 0x11 },
    { 0x00, 0x1C, 0x14, 0x14, 0x1C, 0x04, 0x04, 0x04 },
    { 0x00, 0x1E, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x1E },
    { 0x00, 0x1D, 0x15, 0x17, 0x17, 0x15, 0x15, 0x1D },
    { 0x00, 0x12, 0x14, 0x18, 0x1E, 0x12, 0x12, 0x1E },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    { 0x00, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00 },
    { 0x02, 0x06, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00 },
    { 0x00, 0x08, 0x00, 0x08, 0x08, 0x08, 0x08, 0x08 },
    { 0x00, 0x08, 0x00, 0x08, 0x08, 0x08, 0x12, 0x1E }
};

// Функция отрисовки символа (вертикальный или горизонтальный)
void draw_char(spi_device_handle_t spi, uint16_t x, uint16_t y, uint16_t unicode, uint16_t color, uint8_t vertical) {
    uint8_t index;
    if (unicode >= u'0' && unicode <= u'9') {
        index = unicode - u'0';
    } else if (unicode >= u'А' && unicode <= u'Я') {
        index = 10 + (unicode - u'А');
    } else if (unicode == u'.') {
        index = 43;
    } else if (unicode == u',') {
        index = 44;
    } else if (unicode == u'!') {
        index = 45;
    } else if (unicode == u'?') {
        index = 46;
    } else {
        index = 42; // Пробел
    }

    if (vertical) {
        for (uint8_t col = 0; col < 8; col++) {
            uint8_t pixels = font_8x5[index][col];
        
            for (uint8_t bit = 0; bit < 7; bit++) {
                if (pixels & (1 << bit)) {
                    fill_rect(spi, x + col, y + bit, 1, 1, color);
                }
            }
        }
    } else {
        for (uint8_t col = 0; col < 5; col++) {
            uint8_t pixels = font_5x8[index][col];
            for (uint8_t row = 0; row < 8; row++) {
                if (pixels & (1 << row)) {
                    fill_rect(spi, x + col, y + row, 1, 1, color);
                }
            }
        }
    }
}

// Функция отрисовки строки
void draw_text(spi_device_handle_t spi, uint16_t x, uint16_t y, const uint16_t *unicode_text, uint16_t color, uint8_t vertical) {
    uint8_t xv = (vertical) ? 0 : 6;
    uint8_t yv = (vertical) ? 6 : 0;
    while (*unicode_text) {
        draw_char(spi, x, y, *unicode_text, color, vertical);
        y += yv;
        x += xv;
        unicode_text++;
    }
}
